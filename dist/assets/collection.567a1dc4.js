var O=Object.defineProperty;var S=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var v=(s,e,o)=>e in s?O(s,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[e]=o,y=(s,e)=>{for(var o in e||(e={}))R.call(e,o)&&v(s,o,e[o]);if(S)for(var o of S(e))B.call(e,o)&&v(s,o,e[o]);return s};import C from"./CollectionList.98d1dffe.js";import{E as D}from"./Empty.980eecc3.js";import{_ as E,r as F,a as M,w as m,o as c,c as P,b as u,d as r,u as l,e as G,f as d,F as j,g as z,h as g,i as _,p as K,j as q,n as A}from"./index.7dbf11ab.js";import{g as H,O as J}from"./collection.87132f53.js";import{T as f}from"./index.02745042.js";import"./help.088b247f.js";import"./moment.17f8281e.js";import"./lodash.e3e97856.js";import"./request.869d566e.js";/* empty css                                                          */const W=s=>(K("data-v-87caf30e"),s=s(),q(),s),X={class:"collection"},Y={style:{"min-height":"calc(100vh - 94px)","padding-bottom":"50px"}},Z=W(()=>_("p",null,"\u6CA1\u6709\u66F4\u591A\u4E86",-1)),$={class:"onSale"},ee={setup(s){G();const e=F({active:"have",tab:[{label:"\u6211\u7684\u85CF\u54C1",value:"have"},{label:"\u5BC4\u552E\u4E2D",value:"onSale"},{label:"\u5DF2\u552E\u51FA",value:"sold"}],list:[],isLoading:!1,SaleProductShow:!1,SaleData:null,SalePrice:"",loading:!1,finished:!1,listTotal:0,listQuery:{pageNo:1,pageSize:10}});M(()=>{p()}),m(()=>e.active,a=>{o()}),m(()=>e.listQuery,a=>p(),{deep:!0}),m(()=>e.SalePrice,a=>{A(()=>{let t=a&&String(a).indexOf(".")>-1&&String(a).split(".")[1].length;console.log(t),t>2&&(e.SalePrice=Number(a).toFixed(2))})});const o=()=>{e.loading=!0,e.finished=!1,e.listTotal=0,e.list=[],e.listQuery.pageNo==1?p():e.listQuery.pageNo=1},b=()=>{e.loading=!0,e.isLoading=!0,o()},x=a=>{e.SaleData=a,e.SalePrice=(a==null?void 0:a.type)=="update"?a.SalePrice:"",e.SaleProductShow=!0},L=()=>{if(!e.SalePrice)return f("\u8BF7\u8F93\u5165\u5BC4\u552E\u4EF7\u683C\u54E6~"),!1;T()},V=async()=>{if(e.list.length>=e.listTotal)return!1;e.list.length<e.listTotal&&!e.loading&&(e.loading=!0,e.listQuery.pageNo+=1)},p=async()=>{try{let a=y({action:"GetMyProduct",statusKey:e.active},e.listQuery);const t=await H(a);if(e.isLoading=!1,e.loading=!1,t.code!=0)return f(t.message),!1;e.listTotal=t.total;let n=[...e.list,...t.data];n.length>=e.listTotal?e.finished=!0:e.finished=!1,e.list=n}catch(a){console.log(a),e.isLoading=!1}},T=async(a=e.SaleData)=>{try{let t={action:a.type=="update"?"UpdateSaleProductPrice":"OnSaleProduct",id:a.Id,salePrice:Number(e.SalePrice)};const n=await J(t);if(n.code!=0)return f({message:n.message}),!1;f({message:a.type=="update"?"\u4FEE\u6539\u6210\u529F~":"\u5BC4\u552E\u6210\u529F~"}),e.SalePrice="",setTimeout(()=>{o()},800)}catch(t){console.log(t)}};return(a,t)=>{var h;const n=d("van-list"),w=d("van-tab"),N=d("van-tabs"),k=d("van-pull-refresh"),Q=d("van-field"),U=d("van-dialog");return c(),P("div",X,[u(k,{style:{"min-height":"100%"},modelValue:l(e).isLoading,"onUpdate:modelValue":t[2]||(t[2]=i=>l(e).isLoading=i),onRefresh:b},{default:r(()=>[u(N,{style:{height:"100%"},active:l(e).active,"onUpdate:active":t[1]||(t[1]=i=>l(e).active=i),sticky:"",swipeable:"",color:"#2e2f33"},{default:r(()=>[(c(!0),P(j,null,z(l(e).tab,(i,te)=>(c(),g(w,{name:i.value,title:i.label},{default:r(()=>[_("div",Y,[l(e).list.length?(c(),g(n,{key:0,style:{height:"100%"},modelValue:l(e).loading,"onUpdate:modelValue":t[0]||(t[0]=I=>l(e).loading=I),finished:l(e).finished,offset:40,"finish-text":"\u6CA1\u6709\u66F4\u591A\u4E86",onLoad:V},{finished:r(()=>[Z]),default:r(()=>[u(C,{type:l(e).active,list:l(e).list,onGetList:p,onResetPage:o,onOnSale:x},null,8,["type","list"])]),_:1},8,["modelValue","finished"])):(c(),g(D,{key:1,text:l(e).loading?"\u6570\u636E\u52A0\u8F7D\u4E2D...":"\u6682\u65F6\u6CA1\u6709\u6570\u636E\u54E6~"},null,8,["text"]))])]),_:2},1032,["name","title"]))),256))]),_:1},8,["active"])]),_:1},8,["modelValue"]),u(U,{show:l(e).SaleProductShow,"onUpdate:show":t[4]||(t[4]=i=>l(e).SaleProductShow=i),title:((h=l(e).SaleData)==null?void 0:h.type)=="update"?"\u4FEE\u6539\u85CF\u54C1\u552E\u4EF7":"\u85CF\u54C1\u5BC4\u552E","show-cancel-button":"",onConfirm:L},{default:r(()=>[_("div",$,[u(Q,{modelValue:l(e).SalePrice,"onUpdate:modelValue":t[3]||(t[3]=i=>l(e).SalePrice=i),type:"number",placeholder:"\u8BF7\u8F93\u5165\u5BC4\u552E\u7684\u4EF7\u683C"},null,8,["modelValue"])])]),_:1},8,["show","title"])])}}};var fe=E(ee,[["__scopeId","data-v-87caf30e"]]);export{fe as default};
