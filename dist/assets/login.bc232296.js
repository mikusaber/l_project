import{_ as V,r as I,a as w,o as x,c as N,i as a,b as r,u as i,d as p,p as U,j as E,e as M,f as k,q as y,t as B}from"./index.7dbf11ab.js";import{T as t}from"./index.02745042.js";import{g as L,l as P,a as R}from"./login.66351307.js";import{F as u}from"./Field.5cd11fb6.js";import{i as v,S as g}from"./help.088b247f.js";import"./request.869d566e.js";import"./moment.17f8281e.js";var $="/assets/logo.fba2e727.png";const C=l=>(U("data-v-668ad481"),l=l(),E(),l),q={class:"login"},D=C(()=>a("div",{class:"logo"},[a("img",{src:$,alt:""})],-1)),F={class:"field-box"},G={class:"code-box"},z=C(()=>a("div",{style:{margin:"15px 0",position:"inherit"},id:"slider"},null,-1)),A=y("\u767B\u5F55"),H={setup(l){const h=M(),e=I({nvcType:"nvc_message_h5",isNVC_SUCCESS:"false",mobile:"",code:"",verifyInfo:{timer:null,threshold:60,downTime:0}});w(()=>{v(e.nvcType,m)});function d(o){o.code===800||o.code===900||o.code===500?t(o.message||"\u9A8C\u8BC1\u5931\u8D25~"):o.code===400&&(document.getElementById("slider").innerHTML="",window.nvc.getNC({renderTo:"slider"}),e.nvcType=="nvc_message_h5"?e.isNVC_SUCCESS="message_padding":e.nvcType=="nvc_login_h5"&&(e.isNVC_SUCCESS="login_padding"))}const m=o=>{console.log(o);let{type:n}=o;n=="success"&&e.nvcType=="nvc_message_h5"?(e.isNVC_SUCCESS="message_success",_()):n=="success"&&e.nvcType!="nvc_login_h5"&&(e.isNVC_SUCCESS="login_success")},f=()=>new Promise((o,n)=>{window.nvc.getNVCValAsync(function(s){o(s)})}),S=()=>{let{timer:o,threshold:n}=e.verifyInfo;o||(e.verifyInfo.downTime=n,e.verifyInfo.timer=setInterval(()=>{e.verifyInfo.downTime-=1,e.verifyInfo.downTime<=0&&(e.verifyInfo.downTime=0,clearInterval(e.verifyInfo.timer),e.verifyInfo.timer=null)},1e3))},_=async()=>{try{let o=/^1[3456789]\d{9}$/,n={action:"SendMobileVCode_Login",Mobile:e.mobile};if(!o.exec(n.Mobile))return t("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u7801~"),!1;if(e.isNVC_SUCCESS=="message_padding")return t("\u8BF7\u901A\u8FC7\u6ED1\u5757\u9A8C\u8BC1~"),!1;n.CaptchaParm=await f();const s=await L(n);if(s.code!=0)return d(s),!1;t("\u83B7\u53D6\u6210\u529F~"),e.nvcType="nvc_login_h5",v(e.nvcType,m),S()}catch(o){console.log(o)}},b=async()=>{if(e.nvcType!="nvc_login_h5")return t("\u8BF7\u83B7\u53D6\u9A8C\u8BC1\u7801~"),!1;if(e.isNVC_SUCCESS=="login_padding")return t("\u8BF7\u901A\u8FC7\u6ED1\u5757\u9A8C\u8BC1~"),!1;let o={action:"UserLoginByMobileVCode",Mobile:e.mobile,VCode:e.code};if(o.Mobile){if(!o.VCode)return t("\u8BF7\u586B\u5199\u9A8C\u8BC1\u7801~"),!1}else return t("\u8BF7\u586B\u5199\u624B\u673A\u53F7~"),!1;o.CaptchaParm=await f();const n=await P(o);if(n.code!=0)return d(n),!1;let s={type:"L",data:{action:"add",name:"Token",value:n.data.token},isJson:!1};g(s),T()},T=async()=>{try{const o=await R({action:"GetMemberInfo"});if(o.code!=0)return t(o.message),!1;let n={type:"L",data:{action:"add",name:"UserInfo",value:o.data}};g(n),t("\u767B\u5F55\u6210\u529F~"),setTimeout(()=>{h.replace({name:"home"})},200)}catch(o){console.log(o)}};return(o,n)=>{const s=k("van-button");return x(),N("div",q,[D,a("div",F,[r(u,{"left-icon":"phone-circle-o",modelValue:i(e).mobile,"onUpdate:modelValue":n[0]||(n[0]=c=>i(e).mobile=c),type:"number",maxlength:"11",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",clearable:""},null,8,["modelValue"]),a("div",G,[r(u,{"left-icon":"comment-circle-o",modelValue:i(e).code,"onUpdate:modelValue":n[1]||(n[1]=c=>i(e).code=c),type:"number",maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",clearable:""},null,8,["modelValue"]),r(s,{disabled:i(e).mobile.length!==11||i(e).verifyInfo.downTime,onClick:_,type:"primary",size:"mini",class:"sendText"},{default:p(()=>[y(B(i(e).verifyInfo.downTime!==0?`${i(e).verifyInfo.downTime}s \u91CD\u65B0\u83B7\u53D6`:"\u83B7\u53D6\u9A8C\u8BC1\u7801"),1)]),_:1},8,["disabled"])])]),z,r(s,{disabled:i(e).code.length!=6,onClick:b,style:{"margin-top":"20px"},type:"primary",round:""},{default:p(()=>[A]),_:1},8,["disabled"])])}}};var Z=V(H,[["__scopeId","data-v-668ad481"]]);export{Z as default};
